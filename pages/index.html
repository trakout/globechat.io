<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="intro no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="intro no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="intro no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="intro no-js"> <!--<![endif]-->
<head>
	<meta charset="UTF-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<title>GlobeChat</title>

	<meta name="keywords" content="GlobeChat: Talk the Talk">
	<meta name="description" content="Speak with friends and strangers alike from all borders of the world. Language is not a border.">

	<meta name="viewport" content="width=1024">

	<!-- <link rel="shortcut icon" href="favicon.ico">
	<link rel="apple-touch-icon" href="apple-touch-icon-144x144-precomposed.png">  -->

	<link rel="stylesheet" href="main.css">
	<script src="modernizr-2.6.2.min.js"></script>
	<style type="text/css">
		.hidden {
			display: none;
		}
	</style>
  	
</head>
<body>
<!--[if lt IE 8]>
	<p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
	<![endif]-->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<!--[if gte IE 9]>
	<style type="text/css">
		.gradient {
			filter: none;
		}
	</style>
<![endif]-->

	<h1>GlobeChat!!</h1>

	<div id="conversationSection">
		<h3>Transcript here:</h3>
		<ul id="conversationTranscript"></ul>
		<form action="">
			<input id="messageInput" autocomplete="off" /><button>Send</button>
		</form>
	</div>

	<h3>Online users (click to send request):</h3>
	<ul id="onlineUsers"></ul>

	<h3>Chat requests (click to start chat):</h3>
	<ul id="chatRequests"></ul>

	<script src="/socket.io/socket.io.js"></script>

	<script src="plugins.js"></script>
	<script src="main.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
	<script>

		$(document).ready(function() {
			$('#conversationSection').hide();

			/*************************************************************************************

			* BUTTON HANDLER RELATED STUFF

			*************************************************************************************/

			$('#onlineUsers').on('click','li.onlineUser',function() {    
				requestToChatWithUser($(this).data("user-id"));
			});

			$('#chatRequests').on('click','li.chatRequest',function() {    
				console.log($(this).data("user-id"));
				acceptChatRequest($(this).data("user-id"));
			});

			/*************************************************************************************

			* SOCKET RELATED STUFF

			*************************************************************************************/
			var socket = io();
			$('form').submit(function(){

				// send to the server the message
				socket.emit('chatMessage', $('#messageInput').val());
					$('#messageInput').val('');
				return false;
			});

			// recieved message
			socket.on('chatMessage', function(msg){
				$('#conversationTranscript').append($('<li>').text(msg));
			});

			socket.on('startChat', function () {
				console.log('starting chat');
				$('#conversationSection').show();
			});

			socket.on('receiveChatRequest', function (userObject) {
				console.log("recieved: "+ userObject);
				$('#chatRequests').append('<li class="chatRequest" data-user-id="'+userObject.id+'">'+userObject.name+'</li>');
			});

			// recieved a list of people online
			// NOTE: this will probably be a list of objects later, right now it is strings
			socket.on('listOfUsersOnline', function(userArray) {

				// refresh the list of online users
				$('#onlineUsers').empty();
				var keys = Object.keys(userArray);
				for (var i=0; i<keys.length; ++i) {
					var userObject = userArray[keys[i]];
					$('#onlineUsers').append('<li class="onlineUser" data-user-id="'+userObject.id+'">'+userObject.name+'</li>');
				}
			});

			function requestToChatWithUser(userId) {
				socket.emit('sendChatRequest', userId);
			}

			function acceptChatRequest(userId) {
				socket.emit('acceptChatRequest', userId);
			}
		}); 

	</script>
</body>
</html>

